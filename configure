#!/bin/sh
# Pre-flight check: ensure the Rust toolchain is available before attempting
# to compile the package.  This produces a much friendlier error message than
# the cryptic "cargo: command not found" from make.

# Try the standard rustup install location first, then PATH
CARGO="${CARGO:-${HOME}/.cargo/bin/cargo}"
if ! command -v "$CARGO" >/dev/null 2>&1; then
  CARGO="$(command -v cargo 2>/dev/null || true)"
fi

if [ -z "$CARGO" ] || ! command -v "$CARGO" >/dev/null 2>&1; then
  echo ""
  echo "-------------------------------------------------------------------"
  echo "ERROR: Rust toolchain not found."
  echo ""
  echo "This package requires 'cargo' (the Rust build tool) to compile its"
  echo "native code.  Install Rust via rustup:"
  echo ""
  echo "    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh"
  echo ""
  echo "Then restart your terminal (or run: source ~/.cargo/env) and retry."
  echo "-------------------------------------------------------------------"
  echo ""
  exit 1
fi

echo "* Found cargo at: $CARGO"
"$CARGO" --version
