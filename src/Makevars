LIBDIR = rust/target/release
STATLIB = $(LIBDIR)/liblancedb_r.a
PKG_LIBS = -L$(LIBDIR) -llancedb_r -lpthread -ldl -lm

# Cargo location: honours $CARGO_HOME if set, otherwise defaults to ~/.cargo.
# R resets PATH when spawning the build subprocess, so we cannot rely on
# cargo being on PATH; instead we resolve the absolute path at make-expansion
# time using the HOME environment variable, which R does preserve.
CARGO_HOME ?= $(HOME)/.cargo
CARGO = $(CARGO_HOME)/bin/cargo

all: C_clean

$(SHLIB): $(STATLIB)

$(STATLIB):
	cd rust && "$(CARGO)" build --release --lib

C_clean:
	rm -Rf $(SHLIB) $(STATLIB) $(OBJECTS)

clean:
	rm -Rf $(SHLIB) $(STATLIB) $(OBJECTS) rust/target
